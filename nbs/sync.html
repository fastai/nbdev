---

title: Synchronize and diff


keywords: fastai
sidebar: home_sidebar

summary: "The functions that propagates small changes in the library back to notebooks"
description: "The functions that propagates small changes in the library back to notebooks"
nb_path: "nbs/01_sync.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_sync.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The library is primarily developed in notebooks so any big changes should be made there. But sometimes, it's easier to fix small bugs or typos in the modules directly. <a href="/sync.html#nbdev_update_lib"><code>nbdev_update_lib</code></a> is the function that will propagate those changes back to the corresponding notebooks. Note that you can't create new cells with that functionality, so your corrections should remain limited.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Finding-the-way-back-to-notebooks">Finding the way back to notebooks<a class="anchor-link" href="#Finding-the-way-back-to-notebooks"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to get the name of the object we are looking for, and then we'll try to find it in our index file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_name" class="doc_header"><code>get_name</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_name</code>(<strong><code>obj</code></strong>)</p>
</blockquote>
<p>Get the name of <code>obj</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">DocsTestClass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">get_name</span><span class="p">(</span><span class="n">in_ipython</span><span class="p">),</span> <span class="s1">&#39;in_ipython&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">get_name</span><span class="p">(</span><span class="n">DocsTestClass</span><span class="o">.</span><span class="n">test</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="qual_name" class="doc_header"><code>qual_name</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>qual_name</code>(<strong><code>obj</code></strong>)</p>
</blockquote>
<p>Get the qualified name of <code>obj</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Qualified name is different from name in python for methods and properties:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">qual_name</span><span class="p">(</span><span class="n">DocsTestClass</span><span class="o">.</span><span class="n">test</span><span class="p">),</span> <span class="s1">&#39;DocsTestClass.test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="source_nb" class="doc_header"><code>source_nb</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>source_nb</code>(<strong><code>func</code></strong>, <strong><code>is_name</code></strong>=<em><code>None</code></em>, <strong><code>return_all</code></strong>=<em><code>False</code></em>, <strong><code>mod</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Return the name of the notebook where <code>func</code> was defined</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can either pass an object or its name (by default <code>is_name</code> will look if <code>func</code> is a string or not to determine if it should be <code>True</code> or <code>False</code>, but you can override if there is some inconsistent behavior).</p>
<p>If passed a method of a class, the function will return the notebook in which the largest part of the function name was defined in case there is a monkey-matching that defines <code>class.method</code> in a different notebook than <code>class</code>. If <code>return_all=True</code>, the function will return a tuple with the name by which the function was found and the notebook.</p>
<p>For properties defined using <code>property</code> or our own <code>add_props</code> helper, we approximate the name by looking at their getter functions, since we don't seem to have access to the property name itself. If everything fails (a getter cannot be found), we return the name of the object that contains the property. This suffices for <a href="/sync.html#source_nb"><code>source_nb</code></a> to work.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">source_nb</span><span class="p">(</span><span class="n">notebook2script</span><span class="p">),</span> <span class="s1">&#39;00_export.ipynb&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">source_nb</span><span class="p">(</span><span class="n">DocsTestClass</span><span class="p">),</span> <span class="s1">&#39;00_export.ipynb&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">source_nb</span><span class="p">(</span><span class="n">DocsTestClass</span><span class="o">.</span><span class="n">test</span><span class="p">),</span> <span class="s1">&#39;00_export.ipynb&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">source_nb</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading-the-library">Reading the library<a class="anchor-link" href="#Reading-the-library"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If someone decides to change a module instead of the notebooks, the following functions help update the notebooks accordingly.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="relimport2name" class="doc_header"><code>relimport2name</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>relimport2name</code>(<strong><code>name</code></strong>, <strong><code>mod_name</code></strong>)</p>
</blockquote>
<p>Unwarps a relative import in <code>name</code> according to <code>mod_name</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we say from</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.submodule</span> <span class="kn">import</span> <span class="n">bla</span>
</pre></div>
<p>in a module, it needs to be converted to something like</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">module.submodule</span> <span class="kn">import</span> <span class="n">bla</span>
</pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">module1.module2.submodule</span> <span class="kn">import</span> <span class="n">bla</span>
</pre></div>
<p>depending on where we are. This function deals with those imports renaming.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">relimport2name</span><span class="p">(</span><span class="s1">&#39;.core&#39;</span><span class="p">,</span> <span class="s1">&#39;nbdev/data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;nbdev.core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relimport2name</span><span class="p">(</span><span class="s1">&#39;.core&#39;</span><span class="p">,</span> <span class="s1">&#39;home/sgugger/fastai_dev/nbdev/nbdev/data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;nbdev.core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relimport2name</span><span class="p">(</span><span class="s1">&#39;..core&#39;</span><span class="p">,</span> <span class="s1">&#39;nbdev/vision/data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;nbdev.core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relimport2name</span><span class="p">(</span><span class="s1">&#39;.transform&#39;</span><span class="p">,</span> <span class="s1">&#39;nbdev/vision/data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;nbdev.vision.transform&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relimport2name</span><span class="p">(</span><span class="s1">&#39;..notebook.core&#39;</span><span class="p">,</span> <span class="s1">&#39;nbdev/data/external.py&#39;</span><span class="p">),</span> <span class="s1">&#39;nbdev.notebook.core&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbdev_update_lib" class="doc_header"><code>nbdev_update_lib</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L122" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbdev_update_lib</code>(<strong><code>fname</code></strong>:"A python filename or glob to convert"=<em><code>None</code></em>, <strong><code>silent</code></strong>:"Don't print results"=<em><code>False</code></em>)</p>
</blockquote>
<p>Propagates any change in the modules matching <code>fname</code> to the notebooks that created them</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If <code>fname</code> is not specified, this will convert all modules and submodules in the <code>lib_folder</code> defined in <code>setting.ini</code>. Otherwise <code>fname</code> can be a single filename or a glob expression.</p>
<p><code>silent</code> makes the command not print any statement.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Diff-&amp;-trust-notebooks">Diff &amp; trust notebooks<a class="anchor-link" href="#Diff-&amp;-trust-notebooks"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before making a commit, you may want to check there is no diff between the exported library and the notebooks. You may also want to make this part of your CI, so that you don't accidentally merge a PR that introduces some changes between the two. This function is there to print this diff.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbdev_diff_nbs" class="doc_header"><code>nbdev_diff_nbs</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L140" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbdev_diff_nbs</code>()</p>
</blockquote>
<p>Prints the diff between an export of the library in notebooks and the actual modules</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you receive an output, you'll need to either run <code>notebook2script()</code> or <code>nbdev_update_lib()</code> to fix the difference.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbdev_trust_nbs" class="doc_header"><code>nbdev_trust_nbs</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/sync.py#L157" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbdev_trust_nbs</code>(<strong><code>fname</code></strong>:"A notebook name or glob to convert"=<em><code>None</code></em>, <strong><code>force_all</code></strong>:"Trust even notebooks that haven't changed"=<em><code>False</code></em>)</p>
</blockquote>
<p>Trust notebooks matching <code>fname</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

