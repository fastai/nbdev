---

title: Export to modules


keywords: fastai
sidebar: home_sidebar

summary: "The functions that transform notebooks in a library"
description: "The functions that transform notebooks in a library"
nb_path: "nbs/00_export.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_export.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The most important function defined in this module is <code>notebooks2script</code>, so you may want to jump to it before scrolling though the rest, which explain the details behind the scenes of the conversion from notebooks to library. The main things to remember are:</p>
<ul>
<li>put an <code># export</code> or <code>%nbdev_export</code> flag on each cell you want exported</li>
<li>put an <code># exports</code> or <code>%nbdev_export_and_show</code> flag on each cell you want exported with the source code shown in the docs </li>
<li>put an <code># exporti</code> or <code>%nbdev_export_internal</code> flag on each cell you want exported without it being added to <code>__all__</code>, and without it showing up in the docs.</li>
<li>one cell should contain a <code># default_exp</code> or <code>%nbdev_default_export</code> flag followed by the name of the module (with points for submodules and without the py extension) everything should be exported in (if one specific cell needs to be exported in a different module, just indicate it after the <code>%nbdev_export</code> flag: <code>%nbdev_export special.module</code>)</li>
<li>all left members of an equality, functions and classes will be exported and variables that are not private will be put in the <code>__all__</code> automatically</li>
<li>to add something to <code>__all__</code> if it's not picked automatically, write an exported cell with something like <code>%nbdev_add2all "my_name"</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Basic-foundations">Basic foundations<a class="anchor-link" href="#Basic-foundations"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For bootstrapping <code>nbdev</code> we have a few basic foundations defined in <code>imports</code>, which we test a show here. First, a simple config file class, <code>Config</code> that read the content of your <code>settings.ini</code> file and make it accessible:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Config" class="doc_header"><code>Config</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/imports.py#L37" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>Config</code>(<strong><code>cfg_name</code></strong>=<em><code>'settings.ini'</code></em>)</p>
</blockquote>
<p>Store the basic information for nbdev to work</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_config</span><span class="p">(</span><span class="s2">&quot;github&quot;</span><span class="p">,</span> <span class="s2">&quot;nbdev&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;fastai&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">tst_flags</span><span class="o">=</span><span class="s1">&#39;tst&#39;</span><span class="p">,</span> <span class="n">cfg_name</span><span class="o">=</span><span class="s1">&#39;test_settings.ini&#39;</span><span class="p">)</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">cfg_name</span><span class="o">=</span><span class="s1">&#39;test_settings.ini&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">lib_name</span><span class="p">,</span> <span class="s1">&#39;nbdev&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">git_url</span><span class="p">,</span> <span class="s2">&quot;https://github.com/fastai/nbdev/tree/master/&quot;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;nbdev&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">nbs_path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">doc_path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;docs&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">custom_sidebar</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We derive some useful variables to check what environment we're in:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IN_TEST&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">IN_NOTEBOOK</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">IN_COLAB</span>
    <span class="k">assert</span> <span class="n">IN_IPYTHON</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we have a few util functions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="last_index" class="doc_header"><code>last_index</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/utils.py#L210" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>last_index</code>(<strong><code>x</code></strong>, <strong><code>o</code></strong>)</p>
</blockquote>
<p>Finds the last index of occurence of <code>x</code> in <code>o</code> (returns -1 if no occurence)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">last_index</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">last_index</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">last_index</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compose" class="doc_header"><code>compose</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/utils.py#L378" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compose</code>(<strong>*<code>funcs</code></strong>, <strong><code>order</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create a function that composes all functions in <code>funcs</code>, passing along remaining <code>*args</code> and <code>**kwargs</code> to all</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="n">o</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">p</span>
<span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>  <span class="mi">3</span><span class="p">),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parallel" class="doc_header"><code>parallel</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/utils.py#L710" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parallel</code>(<strong><code>f</code></strong>, <strong><code>items</code></strong>, <strong>*<code>args</code></strong>, <strong><code>n_workers</code></strong>=<em><code>64</code></em>, <strong><code>total</code></strong>=<em><code>None</code></em>, <strong><code>progress</code></strong>=<em><code>None</code></em>, <strong><code>pause</code></strong>=<em><code>0</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Applies <code>func</code> in parallel to <code>items</code>, using <code>n_workers</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span><span class="nn">random</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">add_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> 
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">a</span>

<span class="n">inp</span><span class="p">,</span><span class="n">exp</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">inp</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">inp</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">inp</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">52</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">add_one</span><span class="p">,</span> <span class="n">inp</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">52</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="first" class="doc_header"><code>first</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/utils.py#L204" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>first</code>(<strong><code>x</code></strong>)</p>
</blockquote>
<p>First element of <code>x</code>, or None if missing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading-a-notebook">Reading a notebook<a class="anchor-link" href="#Reading-a-notebook"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What's-a-notebook?">What's a notebook?<a class="anchor-link" href="#What's-a-notebook?"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A jupyter notebook is a json file behind the scenes. We can just read it with the json module, which will return a nested dictionary of dictionaries/lists of dictionaries, but there are some small differences between reading the json and using the tools from <code>nbformat</code> so we'll use this one.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_nb" class="doc_header"><code>read_nb</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_nb</code>(<strong><code>fname</code></strong>)</p>
</blockquote>
<p>Read the notebook in <code>fname</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>fname</code> can be a string or a pathlib object.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_nb</span> <span class="o">=</span> <span class="n">read_nb</span><span class="p">(</span><span class="s1">&#39;00_export.ipynb&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The root has four keys: <code>cells</code> contains the cells of the notebook, <code>metadata</code> some stuff around the version of python used to execute the notebook, <code>nbformat</code> and <code>nbformat_minor</code> the version of nbformat.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_nb</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;cells&#39;, &#39;metadata&#39;, &#39;nbformat&#39;, &#39;nbformat_minor&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;jupytext&#39;: {&#39;split_at_heading&#39;: True},
 &#39;kernelspec&#39;: {&#39;display_name&#39;: &#39;Python 3&#39;,
  &#39;language&#39;: &#39;python&#39;,
  &#39;name&#39;: &#39;python3&#39;},
 &#39;language_info&#39;: {&#39;codemirror_mode&#39;: {&#39;name&#39;: &#39;ipython&#39;, &#39;version&#39;: 3},
  &#39;file_extension&#39;: &#39;.py&#39;,
  &#39;mimetype&#39;: &#39;text/x-python&#39;,
  &#39;name&#39;: &#39;python&#39;,
  &#39;nbconvert_exporter&#39;: &#39;python&#39;,
  &#39;pygments_lexer&#39;: &#39;ipython3&#39;,
  &#39;version&#39;: &#39;3.7.7&#39;},
 &#39;toc&#39;: {&#39;base_numbering&#39;: 1,
  &#39;nav_menu&#39;: {},
  &#39;number_sections&#39;: False,
  &#39;sideBar&#39;: True,
  &#39;skip_h1_title&#39;: True,
  &#39;title_cell&#39;: &#39;Table of Contents&#39;,
  &#39;title_sidebar&#39;: &#39;Contents&#39;,
  &#39;toc_cell&#39;: False,
  &#39;toc_position&#39;: {},
  &#39;toc_section_display&#39;: True,
  &#39;toc_window_display&#39;: False}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;nbformat&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;nbformat_minor&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;4.4&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The cells key then contains a list of cells. Each one is a new dictionary that contains entries like the type (code or markdown), the source (what is written in the cell) and the output (for code cells).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;cell_type&#39;: &#39;code&#39;,
 &#39;execution_count&#39;: 1,
 &#39;metadata&#39;: {&#39;hide_input&#39;: True},
 &#39;outputs&#39;: [{&#39;name&#39;: &#39;stdout&#39;,
   &#39;output_type&#39;: &#39;stream&#39;,
   &#39;text&#39;: &#39;Cells will be exported to nbdev.export,\nunless a different module is specified after an export flag: `%nbdev_export special.module`\n&#39;}],
 &#39;source&#39;: &#39;from nbdev import *\n%nbdev_default_export export\n%nbdev_default_class_level 3&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Finding-patterns">Finding patterns<a class="anchor-link" href="#Finding-patterns"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following functions are used to catch the flags used in the code cells.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_re" class="doc_header"><code>check_re</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_re</code>(<strong><code>cell</code></strong>, <strong><code>pat</code></strong>, <strong><code>code_only</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Check if <code>cell</code> contains a line with regex <code>pat</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pat</code> can be a string or a compiled regex, if <code>code_only=True</code>, this function ignores markdown cells.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;%nbdev_export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;%nbdev_export&#39;</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;# bla&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;cell_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;markdown&#39;</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;%nbdev_export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;%nbdev_export&#39;</span><span class="p">,</span> <span class="n">code_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_re_multi" class="doc_header"><code>check_re_multi</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_re_multi</code>(<strong><code>cell</code></strong>, <strong><code>pats</code></strong>, <strong><code>code_only</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Check if <code>cell</code> contains a line matching any regex in <code>pats</code>, returning the first match found</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;a b c&quot;</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">check_re</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="c1"># show that searching with paterns [&#39;d&#39;,&#39;b&#39;,&#39;a&#39;] will match &#39;b&#39;</span>
<span class="c1"># i.e. &#39;d&#39; is not found and we don&#39;t search for &#39;a&#39;</span>
<span class="k">assert</span> <span class="n">check_re_multi</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">span</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This function returns a regex object that can be used to find nbdev flags in multiline text</p>
<ul>
<li><code>magic_flag</code> pass True to find magic flags, False to find comment flags,</li>
<li><code>body</code> regex fragment to match one or more flags,</li>
<li><code>n_params</code> number of flag parameters to match and catch (-1 for any number of params),</li>
<li><code>comment</code> explains what the compiled regex should do.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_export" class="doc_header"><code>is_export</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L84" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_export</code>(<strong><code>cell</code></strong>, <strong><code>default</code></strong>)</p>
</blockquote>
<p>Check if <code>cell</code> is to be exported and returns the name of the module to export it if provided</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/export.html#is_export"><code>is_export</code></a> returns;</p>
<ul>
<li>a tuple of ("module name", "external boolean") if <code>cell</code> is to be exported or <ul>
<li>"external boolean" will be <code>False</code> for an internal export</li>
</ul>
</li>
<li><code>None</code> if <code>cell</code> will not be exported.</li>
</ul>
<p>The cells to export are marked with an <code>%nbdev_export</code>, <code>%nbdev_export_and_show</code> or <code>%nbdev_export_internal</code> flag, potentially with a module name where we want it exported. The default module is given in a cell of the form <code>%nbdev_default_export bla</code> inside the notebook (usually at the top), though in this function, it needs the be passed (the final script will read the whole notebook to find it).</p>
<ul>
<li>a cell marked with <code>%nbdev_export</code>, <code>%nbdev_export_and_show</code> or <code>%nbdev_export_internal</code> will be exported to the default module</li>
<li>a cell marked with <code>%nbdev_export special.module</code>, <code>%nbdev_export_and_show special.module</code> or <code>%nbdev_export_internal special.module</code> will be exported in special.module (located in <code>lib_name</code>/special/module.py)</li>
<li>a cell marked with <code>%nbdev_export</code> will have it's signature added to the documentation</li>
<li>a cell marked with <code>%nbdev_export_and_show</code> will additionally have it's source code added to the documentation</li>
<li>a cell marked with <code>%nbdev_export_internal</code> will not show up in the documentation, and will also not be added to <code>__all__</code>.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cell</span> <span class="o">=</span> <span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export</span><span class="se">\n</span><span class="s2">from nbdev.imports import *&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exports&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_and_show&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exporti&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_internal&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;export&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# export mod&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export mod</span><span class="se">\n</span><span class="s2">from nbdev.imports import *&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# export mod.file&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mod</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s1">file&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export mod.file&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mod</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s1">file&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exporti mod.file&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mod</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s1">file&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_internal mod.file&quot;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mod</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s1">file&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# expt mod.file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exportmod.file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exportsmod.file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_and_showmod.file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_internalmod.file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;# exporti mod file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">cell</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;%nbdev_export_internal mod file&quot;</span>
<span class="k">assert</span> <span class="n">is_export</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_default_export" class="doc_header"><code>find_default_export</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_default_export</code>(<strong><code>cells</code></strong>)</p>
</blockquote>
<p>Find in <code>cells</code> the default export module.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Stops at the first cell containing a <code># default_exp</code> or <code>%nbdev_default_export</code> flag (if there are several) and returns the value behind. Returns <code>None</code> if there are no cell with that code.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">find_default_export</span><span class="p">(</span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]),</span> <span class="s1">&#39;export&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">find_default_export</span><span class="p">(</span><span class="n">test_nb</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:])</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note: <a href="/export.html#ReTstFlags"><code>ReTstFlags</code></a> isn't used during export but is needed by <a href="/export2html.html"><code>export2html</code></a> and <a href="/test.html"><code>test</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="ReTstFlags" class="doc_header"><code>class</code> <code>ReTstFlags</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L109" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>ReTstFlags</code>(<strong><code>all_flag</code></strong>)</p>
</blockquote>
<p>Provides test flag matching regular expressions</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ReTstFlags.__init__" class="doc_header"><code>ReTstFlags.__init__</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ReTstFlags.__init__</code>(<strong><code>all_flag</code></strong>)</p>
</blockquote>
<p><code>all_flag</code> tells us to match flags applied to all cells (<code>True</code>) or individual cells (<code>False</code>)</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ReTstFlags.findall" class="doc_header"><code>ReTstFlags.findall</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L125" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ReTstFlags.findall</code>(<strong><code>source</code></strong>)</p>
</blockquote>
<p>Return all test flags found in <code>source</code></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ReTstFlags.search" class="doc_header"><code>ReTstFlags.search</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L130" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ReTstFlags.search</code>(<strong><code>source</code></strong>)</p>
</blockquote>
<p>Return a match object for the first test flag found in <code>source</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Listing-all-exported-objects">Listing all exported objects<a class="anchor-link" href="#Listing-all-exported-objects"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following functions make a list of everything that is exported to prepare a proper <code>__all__</code> for our exported module.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span> <span class="o">=</span> <span class="n">_re_patch_func</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">@patch</span>
<span class="s2">@log_args(a=1)</span>
<span class="s2">def func(obj:Class):&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">tst</span><span class="p">,</span> <span class="n">tst</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&lt;re.Match object; span=(1, 42), match=&#39;@patch\n@log_args(a=1)\ndef func(obj:Class)&#39;&gt;,
 (&#39;func&#39;, &#39;Class&#39;, None))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="export_names" class="doc_header"><code>export_names</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L194" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>export_names</code>(<strong><code>code</code></strong>, <strong><code>func_only</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Find the names of the objects, functions or classes defined in <code>code</code> that are exported.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This function only picks the zero-indented objects on the left side of an =, functions or classes (we don't want the class methods for instance) and excludes private names (that begin with <code>_</code>) but no dunder names. It only returns func and class names (not the objects) when <code>func_only=True</code>.</p>
<p>To work properly with fastai added python functionality, this function ignores function decorated with <code>@typedispatch</code> (since they are defined multiple times) and unwraps properly functions decorated with <code>@patch</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func(x):</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass():&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">])</span>

<span class="c1">#Indented funcs are ignored (funcs inside a class)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;  def my_func(x):</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass():&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;MyClass&quot;</span><span class="p">])</span>

<span class="c1">#Private funcs are ignored, dunder are not</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def _my_func():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass():&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;MyClass&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;__version__ = 1:</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass():&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;MyClass&quot;</span><span class="p">,</span> <span class="s2">&quot;__version__&quot;</span><span class="p">])</span>

<span class="c1">#trailing spaces</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass():&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">])</span>

<span class="c1">#class without parenthesis</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">class MyClass:&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">])</span>

<span class="c1">#object and funcs</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">default_bla=[]:&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;default_bla&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">default_bla=[]:&quot;</span><span class="p">,</span> <span class="n">func_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">])</span>

<span class="c1">#Private objects are ignored</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">_default_bla = []:&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">])</span>

<span class="c1">#Objects with dots are privates if one part is private</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">default.bla = []:&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;default.bla&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;def my_func ():</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">default._bla = []:&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;my_func&quot;</span><span class="p">])</span>

<span class="c1">#Monkey-path with @patch are properly renamed</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;@patch</span><span class="se">\n</span><span class="s2">def my_func(x:Class):</span><span class="se">\n</span><span class="s2">  pass&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Class.my_func&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;@patch</span><span class="se">\n</span><span class="s2">def my_func(x:Class):</span><span class="se">\n</span><span class="s2">  pass&quot;</span><span class="p">,</span> <span class="n">func_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Class.my_func&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;some code</span><span class="se">\n</span><span class="s2">@patch</span><span class="se">\n</span><span class="s2">def my_func(x:Class, y):</span><span class="se">\n</span><span class="s2">  pass&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Class.my_func&quot;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;some code</span><span class="se">\n</span><span class="s2">@patch</span><span class="se">\n</span><span class="s2">def my_func(x:(Class1,Class2), y):</span><span class="se">\n</span><span class="s2">  pass&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Class1.my_func&quot;</span><span class="p">,</span> <span class="s2">&quot;Class2.my_func&quot;</span><span class="p">])</span>

<span class="c1">#Check delegates</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;@delegates(keep=True)</span><span class="se">\n</span><span class="s2">class someClass:</span><span class="se">\n</span><span class="s2">  pass&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;someClass&quot;</span><span class="p">])</span>

<span class="c1">#Typedispatch decorated functions shouldn&#39;t be added</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;@patch</span><span class="se">\n</span><span class="s2">def my_func(x:Class):</span><span class="se">\n</span><span class="s2">  pass</span><span class="se">\n</span><span class="s2">@typedispatch</span><span class="se">\n</span><span class="s2">def func(x: TensorImage): pass&quot;</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;Class.my_func&quot;</span><span class="p">])</span>

<span class="c1">#try, except and other keywords should not be picked up (these can look like object def with type annotation)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;try:</span><span class="se">\n</span><span class="s2">    a=1</span><span class="se">\n</span><span class="s2">except:</span><span class="se">\n</span><span class="s2">    b=2&quot;</span><span class="p">),</span> <span class="p">[])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">export_names</span><span class="p">(</span><span class="s2">&quot;try:</span><span class="se">\n</span><span class="s2">    this_might_work</span><span class="se">\n</span><span class="s2">except:</span><span class="se">\n</span><span class="s2">    b=2&quot;</span><span class="p">),</span> <span class="p">[])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extra_add" class="doc_header"><code>extra_add</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extra_add</code>(<strong><code>flags</code></strong>, <strong><code>code</code></strong>)</p>
</blockquote>
<p>Catch adds to <code>__all__</code> required by a cell with <code>_all_=</code> or <code>%nbdev_add2all</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sometimes objects are not picked to be automatically added to the <code>__all__</code> of the module so you will need to add them manually. To do so, create an exported cell with the following code <code>%nbdev_add2all "name", "name2"</code></p>
<p>Please note:</p>
<ul>
<li>elements in <code>%nbdev_add2all</code> can be space and/or comma separated and don't have to be quoted<div class="highlight"><pre><span></span><span class="c1"># &#39;func&#39;, &#39;func2&#39; and &#39;func3&#39; will be added to `__all__`</span>
<span class="o">%</span><span class="n">nbdev_add2all</span> <span class="n">func</span><span class="p">,</span> <span class="n">func2</span> <span class="n">func3</span>
<span class="c1"># you&#39;ll see warnings if any unquoted function names can&#39;t be found</span>
</pre></div>
</li>
<li>elements on a new line will <em>not</em> be added to <code>__all__</code><div class="highlight"><pre><span></span><span class="c1"># &#39;func2&#39; won&#39;t get added to `__all__`</span>
<span class="o">%</span><span class="n">nbdev_add2all</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span>
      <span class="s1">&#39;func2&#39;</span>
</pre></div>
</li>
<li>only the first <code>%nbdev_add2all</code> in a cell will get picked up<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">nbdev_add2all</span> <span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span>
<span class="c1"># `func2` won&#39;t get added to `__all__`</span>
<span class="o">%</span><span class="n">nbdev_add2all</span> <span class="p">[</span><span class="s1">&#39;func2&#39;</span><span class="p">]</span>
</pre></div>
</li>
<li>but you can have any number of <code>%nbdev_add2all</code>s in a notebook by putting them in different cells.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you need a <code>from __future__ import</code> in your library, you can export your cell with special comments:</p>
<div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="k">class</span> <span class="err">...</span>
</pre></div>
<p>or magic flags:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="o">%</span><span class="n">nbdev_export</span>
<span class="k">class</span> <span class="err">...</span>
</pre></div>
<p>Notice that <code>%nbdev_export</code> is after the <code>__future__</code> import. Because <code>__future__</code> imports must occur at the beginning of the file, nbdev allows <code>__future__</code> imports in the flags section of a cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="relative_import" class="doc_header"><code>relative_import</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L266" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>relative_import</code>(<strong><code>name</code></strong>, <strong><code>fname</code></strong>)</p>
</blockquote>
<p>Convert a module <code>name</code> to a name relative to <code>fname</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we say from</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lib_name.module.submodule</span> <span class="kn">import</span> <span class="n">bla</span>
</pre></div>
<p>in a notebook, it needs to be converted to something like</p>

<pre><code>from .module.submodule import bla</code></pre>
<p>or 
<code>from .submodule import bla</code> 
depending on where we are. This function deals with those imports renaming.</p>
<p>Note that import of the form</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lib_name.module</span>
</pre></div>
<p>are left as is as the syntax <code>import module</code> does not work for relative imports.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">relative_import</span><span class="p">(</span><span class="s1">&#39;nbdev.core&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">/</span><span class="s1">&#39;nbdev&#39;</span><span class="o">/</span><span class="s1">&#39;data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;.core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relative_import</span><span class="p">(</span><span class="s1">&#39;nbdev.core&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;nbdev&#39;</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;vision&#39;</span><span class="o">/</span><span class="s1">&#39;data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;..core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relative_import</span><span class="p">(</span><span class="s1">&#39;nbdev.vision.transform&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;nbdev&#39;</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;vision&#39;</span><span class="o">/</span><span class="s1">&#39;data.py&#39;</span><span class="p">),</span> <span class="s1">&#39;.transform&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relative_import</span><span class="p">(</span><span class="s1">&#39;nbdev.notebook.core&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;nbdev&#39;</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;data&#39;</span><span class="o">/</span><span class="s1">&#39;external.py&#39;</span><span class="p">),</span> <span class="s1">&#39;..notebook.core&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">relative_import</span><span class="p">(</span><span class="s1">&#39;nbdev.vision&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;nbdev&#39;</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;vision&#39;</span><span class="o">/</span><span class="s1">&#39;learner.py&#39;</span><span class="p">),</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-the-library">Create the library<a class="anchor-link" href="#Create-the-library"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-an-index">Saving an index<a class="anchor-link" href="#Saving-an-index"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To be able to build back a correspondence between functions and the notebooks they are defined in, we need to store an index. It's done in the private module <code>_nbdev</code> inside your library, and the following function are used to define it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reset_nbdev_module" class="doc_header"><code>reset_nbdev_module</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L291" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reset_nbdev_module</code>()</p>
</blockquote>
<p>Create a skeletton for <code>_nbdev</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_nbdev_module" class="doc_header"><code>get_nbdev_module</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L318" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_nbdev_module</code>()</p>
</blockquote>
<p>Reads <code>_nbdev</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_nbdev_module" class="doc_header"><code>save_nbdev_module</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L332" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_nbdev_module</code>(<strong><code>mod</code></strong>)</p>
</blockquote>
<p>Save <code>mod</code> inside <code>_nbdev</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-modules">Create the modules<a class="anchor-link" href="#Create-the-modules"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_flags_and_code" class="doc_header"><code>split_flags_and_code</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L343" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_flags_and_code</code>(<strong><code>cell</code></strong>, <strong><code>return_type</code></strong>=<em><code>list</code></em>)</p>
</blockquote>
<p>Splits the <code>source</code> of a cell into 2 parts and returns (flags, code)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>return_type</code> tells us if the tuple returned will contain <code>list</code>s of lines or <code>str</code>ings with line breaks.</p>
<p>If no magic flags are found, treat the first comment line as a flag</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html alt="split_flags_and_code example" align="left" max-width="450" file="/images/split_flags_and_code.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If magic flags are found, the flags part can contain multiple lines</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html alt="split_flags_and_code example" align="left" max-width="450" file="/images/split_flags_and_code_magic.png" %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">_test_split_flags_and_code</span><span class="p">(</span><span class="n">expected_flags</span><span class="p">,</span> <span class="n">expected_code</span><span class="p">):</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">nbformat</span><span class="o">.</span><span class="n">v4</span><span class="o">.</span><span class="n">new_code_cell</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expected_flags</span> <span class="o">+</span> <span class="n">expected_code</span><span class="p">))</span>
    <span class="n">test_eq</span><span class="p">((</span><span class="n">expected_flags</span><span class="p">,</span> <span class="n">expected_code</span><span class="p">),</span> <span class="n">split_flags_and_code</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
    <span class="n">expected</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expected_flags</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expected_code</span><span class="p">))</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">split_flags_and_code</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
    
<span class="n">_test_split_flags_and_code</span><span class="p">([</span>
    <span class="s1">&#39;#export&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;# TODO: write this function&#39;</span><span class="p">,</span>
    <span class="s1">&#39;def func(x): pass&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_mod_file" class="doc_header"><code>create_mod_file</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L356" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_mod_file</code>(<strong><code>fname</code></strong>, <strong><code>nb_path</code></strong>)</p>
</blockquote>
<p>Create a module file for <code>fname</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A new module filename is created each time a notebook has a cell marked with <code>%nbdev_default_export</code>. In your collection of notebooks, you should only have one notebook that creates a given module since they are re-created each time you do a library build (to ensure the library is clean). Note that any file you create manually will never be overwritten (unless it has the same name as one of the modules defined in a <code>%nbdev_default_export</code> cell) so you are responsible to clean up those yourself.</p>
<p><code>fname</code> is the notebook that contained the <code>%nbdev_default_export</code> cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_mod_files" class="doc_header"><code>create_mod_files</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L365" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_mod_files</code>(<strong><code>files</code></strong>, <strong><code>to_dict</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Create mod files for default exports found in <code>files</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create module files for all <code>%nbdev_default_export</code> flags found in <code>files</code> and return a list containing the names of modules created.</p>
<p>Note: The number if modules returned will be less that the number of files passed in if files do not <code>%nbdev_default_export</code>.</p>
<p>By creating all module files before calling <code>_notebook2script</code>, the order of execution no longer matters - so you can now export to a notebook that is run "later".</p>
<p>You might still have problems when</p>
<ul>
<li>converting a subset of notebooks or</li>
<li>exporting to a module that does not have a <code>%nbdev_default_export</code> yet</li>
</ul>
<p>in which case <code>_notebook2script</code> will print warnings like;</p>

<pre><code>Warning: Exporting to "core.py" but this module is not part of this build</code></pre>
<p>If you see a warning like this</p>
<ul>
<li>and the module file (e.g. "core.py") does not exist, you'll see a <code>FileNotFoundError</code></li>
<li>if the module file exists, the exported cell will be written - even if the exported cell is already in the module file</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_init" class="doc_header"><code>add_init</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L418" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_init</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Add <code>__init__.py</code> in all subdirs of <code>path</code> containing python files if it's not there already</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a&#39;</span><span class="o">/</span><span class="s1">&#39;f.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a/b&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a&#39;</span><span class="o">/</span><span class="s1">&#39;b&#39;</span><span class="o">/</span><span class="s1">&#39;f.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
    <span class="n">add_init</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;a/b&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_version" class="doc_header"><code>update_version</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L430" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_version</code>()</p>
</blockquote>
<p>Add or update <code>__version__</code> in the main <code>__init__.py</code> of the library</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="update_baseurl" class="doc_header"><code>update_baseurl</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L444" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>update_baseurl</code>()</p>
</blockquote>
<p>Add or update <code>baseurl</code> in <code>_config.yml</code> for the docs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="notebook2script" class="doc_header"><code>notebook2script</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L454" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>notebook2script</code>(<strong><code>fname</code></strong>=<em><code>None</code></em>, <strong><code>silent</code></strong>=<em><code>False</code></em>, <strong><code>to_dict</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Convert notebooks matching <code>fname</code> to modules</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finds cells starting with <code>%nbdev_export</code> and puts them into the appropriate module. If <code>fname</code> is not specified, this will convert all notebook not beginning with an underscore in the <code>nb_folder</code> defined in <code>setting.ini</code>. Otherwise <code>fname</code> can be a single filename or a glob expression.</p>
<p><code>silent</code> makes the command not print any statement and <code>to_dict</code> is used internally to convert the library to a dictionary.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="DocsTestClass" class="doc_header"><code>class</code> <code>DocsTestClass</code><a href="https://github.com/fastai/nbdev/tree/master/nbdev/export.py#L471" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>DocsTestClass</code>()</p>
</blockquote>
<p>for tests only</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

